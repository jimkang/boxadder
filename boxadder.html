<head>
  <title>Boxadder</title>
</head>

<body>
	
  <div id="outer">		
	  <div class="nonboard">	
			{{loginButtons align="right"}}
			
			<br /><br />
			{{> boardMetadataSection }}
			{{> boardAdminSection }}
			<br />
			{{> boardList }}
			<br />
			{{> deleteBoard }}
		
		</div>

		<div>
			{{> boardControlBar }}	
			{{> board }}
		</div>
  </div>
</body>

<template name="board">
  <div class="board">
      <svg width="768" height="1024" id="boardSVG">
			  <defs>
					  <path id="deleteButtonPath" d="M 0 0 L 12 12 M 12 0 L 0 12"
						fill="none" stroke="#282828" stroke-width="7" stroke-opacity="0.5"
						onclick="console.log(this)">
							<!-- <animate attributeName="d" from="M 0 0 L 20 20 M 20 0 L 0 20"
							 to="M -2 -2 L 22 22 M 22 -2 L -2 22" 
							 begin="click" dur="0.05s" fill="freeze" />
							<animate attributeName="stroke-width" from="8" to="10" 
							 begin="click" dur="0.05s" fill="freeze" />
							<animate attributeName="stroke-opacity" from="0.5" to="1.0" 
							 begin="click" dur="0.05s" fill="freeze" />	-->
						
					 </path>
				 </symbol>
			  </defs>
				
        <g class="boxZone">
										
					<!-- <use x="100" y="100" xlink:href="#deleteButtonPath">
					</use> -->
				  <!-- <path id="closeButtonPath" d="M 0 0 L 20 20 M 20 0 L 0 20"
					fill="none" stroke="#282828" stroke-width="8" stroke-opacity="0.7"
					onclick="console.log(this)" x="100" y="100">
						<animate attributeName="d" from="M 0 0 L 20 20 M 20 0 L 0 20"
						 to="M -2 -2 L 22 22 M 22 -2 L -2 22" 
						 begin="mousedown" dur="0.05s" fill="freeze" />
						<animate attributeName="stroke-width" from="8" to="10" 
						 begin="mousedown" dur="0.05s" fill="freeze" />
						<animate attributeName="stroke-opacity" from="0.5" to="1.0" 
						 begin="mousedown" dur="0.05s" fill="freeze" />						
				 </path> -->
					
        </g>
      </svg>
  </div>
</template>

<template name="sumContainer">
  <div class="sumcontainer">Sum:  
		<span id="sum">{{sum}}</span>
  </div>
</template>

<template name="boardControlBar">
  {{#if boardIsWritable}}
	  <span id="new-item-box">
	    <input type="button" class="addNewItem" value="Add Item" />
	  </span>
		
		<span>
			<button type="button" class="addNewBox">Add Box</button>
		</span>
				
		<p><span class="explanation">Boxadder calculates the sum of items in boxes. As you change things, other people looking at the same board will see those changes.</span></p>
		<p><span class="explanation">Add items and boxes with the buttons, then move them around and edit their values. Use the mouse wheel or pinch gestures to zoom in and out and click and drag on empty spaces to pan around.</span></p>

	{{/if}}
</template>

<template name="boardAdminSection">
	{{#if signedIn}}
		<div>
			<button type="button" class="addBoard">Add Board</button>
			<button type="button" class="copyBoard">Copy Board</button>
		</div>
	  {{#if showNewBoardDialog}}
	    {{> newBoardDialog}}
	  {{/if}}
	{{else}}
		<span class="selected"><strong>Sign in</strong></span> to add new boards and to mess with existing ones!
		<br />
	{{/if}}
</template>

<template name="newBoardDialog">
  <div class="mask"> </div>
  <div class="modal">
    <div class="modal-header">
      <button type="button" class="close cancel">&times;</button>
    </div>

    <div class="modal-body">
      {{#if error}}
        <div class="alert alert-error">{{error}}</div>
      {{/if}}
			
			<form name="newBoardForm">
	      <label>Name</label>
	      <input type="text" class="newBoardName span5">
				<br />

	      <label>Anyone can see it</label>
	      <input type="checkbox" name="publiclyReadable" 
				class="publiclyReadable" />
				<br />

	      <label>Anyone can change it</label>
	      <input type="checkbox" name="publiclyWritable"
				class="publiclyWritable"/>
			</form>
    </div>

    <div class="modal-footer">
      <a href="#" class="btn cancel">Cancel</a>
      <a href="#" class="btn btn-primary save">Add</a>
    </div>
  </div>
</template>

<template name="boardList">
	<span id="boardListHeader">Boards</span>
	<br />
	<div id="boardList">
		{{#each boards}}
			{{! onclick is there so that Mobile Safari will understand right away 
				that this is tappable.}}
			<div class="boardListItem {{selectedClass}}" onclick="void(0)">
				<span class="boardListItemLabel">{{name}}</span>
			</div>
		{{/each}}
	</div>
</template>

<template name="boardMetadataSection">	
  {{#if error}}
    <div class="alert alert-error">{{error}}</div>
  {{/if}}

  {{#if loadingMessage}}
    <div class="alert loading">{{loadingMessage}}</div>
  {{/if}}
	
	{{#if currentBoardIsSet}}
		<div class="boardMetadataSection">
			{{#with board}}
				The {{name}} board is:
				<ul>
					<li>
						<span class="{{visibilityCssClass}}">{{visibilitySummary}}</span>
					</li>
					<li>
						<span class="{{writabilityCssClass}}">{{writabilitySummary}}</span>
					</li>
				</ul>				
			{{/with}}
		</div>
	{{/if}}
</template>

<template name="deleteBoard">
	{{#if canDeleteCurrentBoard}}
		<div class="boardMetadataSection">
			{{#with board}}
				<span>
					<button type="button" class="delete">Delete {{name}} board</button>
				</span>				
			{{/with}}
		</div>
	{{/if}}
</template>
