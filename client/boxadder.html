<head>
  <title>Boxadder</title>
</head>

<body>
	
  <div id="outer">		
	  <div class="nonboard">	
			{{loginButtons align="right"}}
			
			<br /><br />
			{{> boardMetadataSection }}
			{{> boardAdminSection }}
			<br />
			{{> boardList }}
			<br />
			{{> deleteBoard }}
		
		</div>

		<div>
			{{> boardControlBar }}	
			{{> board }}
		</div>
  </div>
</body>

<template name="board">
  <div class="board">
      <svg width="768" height="1024" id="boardSVG">
			  <defs>
				  <path id="deleteButtonPath" d="M 0 0 L 13 13 M 13 0 L 0 13"
					fill="none" stroke="#282828" stroke-width="7" stroke-opacity="0.5" 
					class="deleteButton"/>
					
					<mask id="resizeGripStripeMask">
						<path 
						d="M 15 1 L 1 15 M 15 5 L 5 15 M 15 9 L 9 15 M 15 13 L 13 15" 
						stroke-width="2" stroke="white" stroke-linecap="round" />
					</mask>
					
					<!-- Making resizeGrip a rect instead of the stripes path so that 
					users don't have to click on one of the stripes in order to drag it.
					-->
					<rect id="resizeGrip" class="resize-handle" width="44" height="44"
					fill-opacity="0.25" fill="black" mask="url(#resizeGripStripeMask)" />

			  </defs>
				
        <g class="boxZone">
        </g>
      </svg>
  </div>
</template>

<template name="sumContainer">
  <div class="sumcontainer">Sum:  
		<span id="sum">{{sum}}</span>
  </div>
</template>

<template name="boardControlBar">	
  {{#if boardIsWritable}}
	  <span id="new-item-box">
	    <input type="button" class="addNewItem" value="Add Item" />
	  </span>
		
		<span>
			<button type="button" class="addNewBox">Add Box</button>
		</span>
	{{/if}}
	<span {{#if currentBoardIsSet}}class="rightJustified"{{/if}}>
		<a href="mailto:jimkang@ghostcrabworkshop.com?subject=Boxadder" target="_blank">
			<button type="button" class="questionsButton">Questions/Comments</button>
		</a>
	</span>				
	
	<p><span class="explanation">Boxadder calculates the sum of items in boxes. As you change things, other people looking at the same board will see those changes.
	{{#if currentBoardNotSet}}
	Select a board from the list to get started or create a new one.
	{{/if}}
	</span></p>
	
	{{#if boardIsWritable}}
		<p><span class="explanation">Add items and boxes with the buttons, then move them around and edit their values. Use the mouse wheel or pinch gestures to zoom in and out and click and drag on empty spaces to pan around.</span></p>
	{{/if}}
	
</template>

<template name="boardAdminSection">
	{{#if signedIn}}
		<div>
			<button type="button" class="addBoard">Add Board</button>
			<button type="button" class="copyBoard">Copy Board</button>
		</div>
	  {{#if showNewBoardDialog}}
	    {{> newBoardDialog}}
	  {{/if}}
	{{else}}
		<span class="selected"><strong>Sign in</strong></span> to add new boards and to mess with existing ones!
		<br />
	{{/if}}
</template>

<template name="newBoardDialog">
  <div class="mask"> </div>
  <div class="modal">
    <div class="modal-header">
      <button type="button" class="close cancel">&times;</button>
    </div>

    <div class="modal-body">
      {{#if error}}
        <div class="alert alert-error">{{error}}</div>
      {{/if}}
			
			<form name="newBoardForm">
	      <label>Name</label>
	      <input type="text" class="newBoardName span5">
				<br />

	      <label>Anyone can see it</label>
	      <input type="checkbox" name="publiclyReadable" 
				class="publiclyReadable" />
				<br />

	      <label>Anyone can change it</label>
	      <input type="checkbox" name="publiclyWritable"
				class="publiclyWritable"/>
			</form>
    </div>

    <div class="modal-footer">
      <a href="#" class="btn cancel">Cancel</a>
      <a href="#" class="btn btn-primary save">Add</a>
    </div>
  </div>
</template>

<template name="boardList">
	<span id="boardListHeader">Boards</span>
	<br />
	<div id="boardList">
		{{#each boards}}
			{{! onclick is there so that Mobile Safari will understand right away 
				that this is tappable.}}
			<div class="boardListItem {{selectedClass}}" onclick="void(0)">
				<span class="boardListItemLabel">{{name}}</span>
			</div>
		{{/each}}
	</div>
</template>

<template name="boardMetadataSection">	
  {{#if error}}
    <div class="alert alert-error">{{error}}</div>
  {{/if}}

  {{#if loadingMessage}}
    <div class="alert loading">{{loadingMessage}}</div>
  {{/if}}
	
	{{#if currentBoardIsSet}}
		<div class="boardMetadataSection">
			{{#with board}}
				The {{name}} board is:
				<ul>
					<li>
						<span class="{{visibilityCssClass}}">{{visibilitySummary}}</span>
					</li>
					<li>
						<span class="{{writabilityCssClass}}">{{writabilitySummary}}</span>
					</li>
				</ul>				
			{{/with}}
		</div>
	{{/if}}
</template>

<template name="deleteBoard">
	{{#if canDeleteCurrentBoard}}
		<div class="boardMetadataSection">
			{{#with board}}
				<span>
					<button type="button" class="delete">Delete {{name}} board</button>
				</span>				
			{{/with}}
		</div>
	{{/if}}
</template>
